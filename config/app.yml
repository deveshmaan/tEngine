run_id: "dev-run"
persistence_path: "engine_state.sqlite"
strategy_tag: "advanced-buy"
capital_base: 43000
# Secrets (Upstox tokens/API keys) must be set via environment variables, not committed here.
allowed_ips: [] # Optional static IP allowlist; can also be set via ALLOWED_IPS env var (comma-separated)

data:
  index_symbol: "NIFTY"
  lot_step: 65
  tick_size: 0.05
  price_band_low: 3.0
  price_band_high: 99999.0
  expiry_ttl_minutes: 5
  weekly_expiry_weekday: 1 # 0=Monday â€¦ 6=Sunday; 1 == Tuesday for NIFTY weekly expiry
  subscription_expiry_preference: "current" # allowed: current | next | monthly
  holidays:
    - "2024-08-15"
    - "2024-10-02"
    - "2024-12-25"
  strike_steps:
    NIFTY: 50
    BANKNIFTY: 100

market_data:
  window_steps: 8 # +/- steps around ATM
  option_type: "BOTH" # CE | PE | BOTH
  stream_mode: "full_d30"
  depth_levels: 5 # render top 5 in UI to keep UI light
  max_tick_age_seconds: 2.0

strategy:
  short_ma: 3
  long_ma: 10
  iv_threshold: 0.0
  vol_breakout_mult: 1.0
  imi_period: 14
  pcr_extreme_high: 5.0
  pcr_extreme_low: 0.3
  iv_percentile_threshold: 0.3
  iv_exit_percentile: 0.9
  oi_volume_min_threshold: 50
  event_file_path: "config/events.yml"
  gamma_threshold: 0.0
  min_minutes_to_expiry: 30
  event_halt_minutes: 30
  enable_call_entries: true
  enable_put_entries: true
  breakout_window: 5
  breakout_margin: 5
  volume_mult: 1.0
  pcr_range: [0.3, 5.0]
  spread_max_pct: 0.08
  orb_atr_period: 14
  min_or_atr_mult: 0.55
  max_or_atr_mult: 2.50
  buffer_atr_mult: 0.35
  breakout_buffer_pts: 5.0
  use_atr_filter: true
  orb_max_trades_per_session: 1

banknifty:
  vol_breakout_mult: 1.2

risk:
  daily_pnl_stop: 5000 # max you are willing to lose in a day
  per_symbol_loss_stop: 1000
  max_open_lots: 1
  notional_premium_cap: 40000
  no_new_entries_after: "15:20:00"
  square_off_by: "15:25:00"
  max_order_rate: 5
  risk_percent_per_trade: 12.0 # percent of capital per trade; ~1 lot at current NIFTY option premiums
  scalping_risk_pct: 0.5
  scalping_trades_per_hour: 30
  max_slippage_pct_per_trade: 0.0 # 0 disables slippage halt
  max_avg_slippage_pct_per_day: 0.0 # 0 disables
  max_slippage_trades: 0 # 0 disables
  max_entry_spread_pct: 0.0 # 0 disables
  max_trades_per_day: 5 # 0 disables
  max_consecutive_losses: 3 # 0 disables
  max_intraday_index_move_pct_window: 0.0 # 0 disables
  extreme_move_window_seconds: 0 # 0 disables

broker:
  max_order_rate: 15
  rest_timeout: 3.0
  ws_heartbeat_interval: 3.0
  ws_backoff_seconds: [1, 2, 5, 10]
  oauth_refresh_margin: 60
  rate_limits:
    place:
      rate_per_sec: 5
      burst: 10
    modify:
      rate_per_sec: 3
      burst: 6
    cancel:
      rate_per_sec: 3
      burst: 6
    history:
      rate_per_sec: 2
      burst: 4

oms:
  resubmit_backoff: 0.5
  reconciliation_interval: 2.0
  max_inflight_orders: 2
  order_timeout_seconds: 3.0
  submit:
    default: "auto"
    max_spread_ticks: 2
    depth_threshold: 10

exit:
  stop_pct: 0.2            # 20% hard stop from entry
  target1_pct: 0.25        # take partial profit at +25% from entry
  partial_fraction: 0.5    # sell 50% at target1
  trail_lock_pct: 0.4      # lock 40% of gains when trailing engages
  trail_giveback_pct: 0.5  # give back up to 50% of locked gains before exit
  min_trail_ticks: 3
  max_holding_minutes: 20
  trailing_stop_pct: 0.1    # 10% trailing stop on remaining position after partial
  time_stop_minutes: 30
  partial_target_multiplier: 0.0
  trailing_pct: 0.2        # start trailing after +20% move
  trailing_step: 0.1       # trail in 10% increments of gains
  time_buffer_minutes: 20
  partial_tp_mult: 2.0
  at_pct: 1.0
  scalping_profit_target_pct: 0.12
  scalping_stop_loss_pct: 0.06
  scalping_time_limit_minutes: 5

alerts:
  throttle_seconds: 30

telemetry:
  metrics_port_env: "METRICS_PORT"

replay:
  default_speed: 1.0

smoke_test:
  enabled: false # turn on for the day
  underlying: "NIFTY" # or "BANKNIFTY" later
  side: "CE" # start with CALL, you can test PE on another day
  hold_seconds: 60 # start with 60s, you can bump to 120 later
  lots: 1
  max_notional_rupees: 35000
